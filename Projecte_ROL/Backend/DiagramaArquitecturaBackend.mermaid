%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#ffd8d8', 'edgeLabelBackground':'#ffffff'}}}%%
graph TD
    subgraph Frontend
        F[Client App] -->|HTTP Requests| B
    end

    subgraph Backend[Backend - Flask]
        B[Flask App] -->|Routing| C[Controllers]
        C -->|Authentication| J[JWT Manager]
        C -->|Data Access| D[Database Layer]
        C -->|Business Logic| S[Services]
        
        subgraph Authentication
            J -->|Create Tokens| L[Login]
            J -->|Verify Tokens| P[Protected Routes]
        end

        subgraph Controllers
            L -->|POST /login| U[User Auth]
            P -->|GET/POST /characters| CH[Character Mgmt]
            P -->|GET/POST /game_sessions| GS[Game Sessions]
            P -->|POST /combat| CM[Combat System]
            P -->|POST /game_logs| GL[Action Logging]
        end

        subgraph Services
            CH -->|Validate Data| CD[Character Domain]
            GS -->|Session Logic| GD[Game Domain]
            CM -->|Combat Rules| CR[Combat Rules]
            GL -->|Log Actions| LD[Logging Service]
        end

        subgraph Database Layer
            D -->|MySQL Connector| DB[(MySQL Database)]
            DB -->|users| UD[User Data]
            DB -->|characters| CDB[Characters]
            DB -->|game_sessions| GDB[Game Sessions]
            DB -->|combat_data| CMDB[Combat Tables]
            DB -->|logs| LDB[Game Logs]
        end
    end

    style B fill:#f9d5e5,stroke:#333
    style J fill:#e3eaa7,stroke:#333
    style DB fill:#b2d3c2,stroke:#333
    style F fill:#82b4d6,stroke:#333